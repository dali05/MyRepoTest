package com.lma.apiresponse.api.exception;

import org.junit.jupiter.api.Test;
import org.springframework.http.HttpStatus;

import static org.junit.jupiter.api.Assertions.*;

/**
 * Tests unitaires pour BusinessRuleException.
 */
class BusinessRuleExceptionTest {

    enum DummyBusinessErrorCode implements BusinessErrorCode {
        INVALID_AMOUNT("BUS-001", "Invalid amount"),
        ACCOUNT_LOCKED("BUS-002", "Account is locked");

        private final String code;
        private final String defaultMessage;

        DummyBusinessErrorCode(String code, String defaultMessage) {
            this.code = code;
            this.defaultMessage = defaultMessage;
        }

        @Override
        public String code() {
            return code;
        }

        @Override
        public String defaultMessage() {
            return defaultMessage;
        }
    }

    @Test
    void testConstructor_usesDefaultMessage() {
        BusinessRuleException ex = new BusinessRuleException(DummyBusinessErrorCode.INVALID_AMOUNT);

        assertEquals(ErrorType.BUSINESS_ERROR, ex.getType());
        assertEquals(422, ex.getStatus());
        assertEquals("BUS-001", ex.getCode());
        assertEquals("Invalid amount", ex.getMessage());
        assertEquals(DummyBusinessErrorCode.INVALID_AMOUNT, ex.getBusinessError());
    }

    @Test
    void testConstructor_usesCustomMessage() {
        BusinessRuleException ex = new BusinessRuleException(DummyBusinessErrorCode.ACCOUNT_LOCKED, "This account cannot be used");

        assertEquals(ErrorType.BUSINESS_ERROR, ex.getType());
        assertEquals(422, ex.getStatus());
        assertEquals("BUS-002", ex.getCode());
        assertEquals("This account cannot be used", ex.getMessage());
        assertEquals(DummyBusinessErrorCode.ACCOUNT_LOCKED, ex.getBusinessError());
    }
}
